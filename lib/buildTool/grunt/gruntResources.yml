init:
  packages:
    - <<: *pkg_grunt
    - <<: *pkg_grunt-cli
    - <<: *pkg_grunt-extend-config
    - <<: *pkg_load-grunt-tasks

  templateFiles:
    - src: Gruntfile.js.tpl
      dest: Gruntfile.js
      overwrite: true

serverDev:
  packages:
    - <<: *pkg_grunt-contrib-watch
    - <<: *pkg_grunt-contrib-connect
    - <<: *pkg_js-yaml

  tasks:
    - name: serve:dev
      tasks: ['grunt connect:dev']
      description: Runs a dev server using `grunt-connect` on **<%= serverDev.protocol + '://' + serverDev.hostname + ':' + serverDev.port %>**
      features:
        - HTTP or HTTPS
        - LiveReload support
        - 'Port can be overridden on command line: `-- -port=1234`'
        - 'Browser can be opened to a specific path via command line: `-- -url=sub/path`'

  templateFiles:
    - src: serverDev.js.tpl
      dest: <%= paths.config.configDir %>grunt/serverDev.js
      overwrite: true

serverProd:
  packages:
    - <<: *pkg_grunt-contrib-watch
    - <<: *pkg_grunt-contrib-connect
    - <<: *pkg_js-yaml

  tasks:
    - name: serve:prod
      tasks: ['grunt connect:prod']
      description: Runs a production server using `grunt-connect` on **<%= serverProd.protocol + '://' + serverProd.hostname + ':' + serverProd.port %>**
      features:
        - HTTP or HTTPS
        - 'Port can be overridden on command line: `-- -port=1234`'
        - 'Browser can be opened to a specific path via command line: `-- -url=sub/path`'

  templateFiles:
    - src: serverProd.js.tpl
      dest: <%= paths.config.configDir %>grunt/serverProd.js

verify:
  # Common packages
  packages:
    - <<: *pkg_grunt-newer
    - <<: *pkg_grunt-contrib-watch

  templateFiles:
    - src: gruntVerify.js.tpl
      dest: <%= paths.config.configDir %>grunt/verify.js
      overwrite: true

  cssCodingStandard:  # This is not quite an accurate name, but it is good enough for now.
    css:
      packages: []
    sass:
      packages:
        - <<: *pkg_grunt-sass-lint
    stylus:
      packages:
        - <<: *pkg_grunt-stylint

  jsCodingStandard:
    none:
      packages:
        - <<: *pkg_grunt-eslint
        - <<: *pkg_grunt-newer

    AirBnB:
      packages:
        - <<: *pkg_grunt-eslint
        - <<: *pkg_grunt-newer

    Google:
      packages:
        - <<: *pkg_grunt-eslint
        - <<: *pkg_grunt-newer

    StandardJS:
      packages:
        - <<: *pkg_grunt-eslint
        - <<: *pkg_grunt-newer

    TypeScript:
      packages:
        - <<: *pkg_grunt-tslint

  tasks:
    - name: verify
      tasks: ['grunt verify']
      description: Verify JS & CSS code style and syntax
      features:
        - Verifies source *and test code* (unlike Webpack loaders)

    - name: verify:watch
      tasks: ['grunt watch:verify']
      description: Runs verify task whenever JS or CSS code is changed
      features: []

zzfinish:
  onEnd:
    - cmd: grunt
      args: ['dev', '--url=index.html']
